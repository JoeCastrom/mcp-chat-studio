<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MCP Chat - Tool Testing Studio</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <header class="header">
      <div class="logo">
        <div class="logo-icon">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path>
          </svg>
        </div>
        <span class="logo-text">MCP Chat</span>
        <span class="logo-badge">Studio</span>
      </div>
      <div class="header-actions">
        <!-- Model Badge -->
        <div
          id="modelBadge"
          class="model-badge"
          onclick="showSettingsModal()"
          title="Click to change LLM settings"
        >
          <span id="modelProvider">ğŸ¦™</span>
          <span id="modelName">llama3.1:8b</span>
        </div>

        <!-- Token Usage Badge -->
        <div
          id="tokenBadge"
          class="model-badge"
          onclick="showTokenUsage()"
          title="Token usage this session (click for details)"
          style="font-size: 0.7rem; padding: 4px 8px"
        >
          <span>ğŸ“Š</span>
          <span id="tokenCount">0 tokens</span>
        </div>

        <!-- Branches Button -->
        <button
          class="btn"
          onclick="showBranchesModal()"
          title="Manage conversation branches"
          style="font-size: 0.7rem; padding: 4px 8px"
        >
          ğŸŒ¿ Branches
        </button>

        <!-- Theme Toggle -->
        <button
          class="btn theme-toggle"
          id="themeToggle"
          onclick="toggleTheme()"
          title="Toggle light/dark theme"
        >
          <span id="themeIcon">ğŸŒ™</span>
        </button>

        <div id="userSection"></div>
        <button class="btn" onclick="showSettingsModal()" title="LLM Settings">âš™ï¸</button>
        <button class="btn" id="toggleSidebar">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="7"></rect>
            <rect x="14" y="3" width="7" height="7"></rect>
            <rect x="14" y="14" width="7" height="7"></rect>
            <rect x="3" y="14" width="7" height="7"></rect>
          </svg>
          MCP Tools
        </button>
        <button class="btn" id="clearChat">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M3 6h18"></path>
            <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"></path>
            <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"></path>
          </svg>
          Clear
        </button>
        <button class="btn" onclick="showShortcutsHelp()" title="Keyboard Shortcuts (Ctrl+/)">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="10"></circle>
            <path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"></path>
            <line x1="12" y1="17" x2="12.01" y2="17"></line>
          </svg>
          ?
        </button>
      </div>
    </header>

    <main class="main">
      <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
          <span class="sidebar-title">MCP Servers</span>
          <div style="display: flex; gap: var(--spacing-xs); align-items: center">
            <button class="add-server-btn" onclick="showAddServerModal()" title="Add MCP Server">
              + Add
            </button>
            <button class="btn" onclick="exportConfig()" title="Export Config">ğŸ“¥</button>
            <button class="btn" onclick="importConfigFile()" title="Import Config">ğŸ“¤</button>
            <span class="sidebar-status" id="serverCount">0 connected</span>
          </div>
        </div>

        <!-- Hidden file input for import -->
        <input
          type="file"
          id="configFileInput"
          accept=".yaml,.yml,.json"
          style="display: none"
          onchange="handleConfigFileImport(event)"
        />

        <!-- Environment Profile -->
        <div style="padding: 8px 12px; border-bottom: 1px solid var(--border)">
          <label
            style="font-size: 0.7rem; color: var(--text-muted); display: block; margin-bottom: 4px"
            >Environment</label
          >
          <select
            id="envProfile"
            class="form-select"
            onchange="switchEnvironment(this.value)"
            style="width: 100%; font-size: 0.75rem; padding: 4px 8px"
          >
            <option value="development">ğŸ› ï¸ Development</option>
            <option value="staging">ğŸ§ª Staging</option>
            <option value="production">ğŸš€ Production</option>
          </select>
        </div>

        <!-- Tool Search -->
        <div class="tool-search">
          <input
            type="text"
            id="toolSearchInput"
            placeholder="ğŸ” Search tools..."
            oninput="filterTools(this.value)"
          />
          <label class="toggle" style="font-size: 0.75rem; margin-bottom: 4px">
            <input type="checkbox" id="includeRiskyTools" />
            <span class="switch"></span>
            <span>âš ï¸ Include risky tools</span>
          </label>
          <button
            class="test-all-btn"
            id="testAllBtn"
            onclick="testAllTools()"
            title="Test all connected tools"
          >
            ğŸ§ª Test All Tools
          </button>
        </div>

        <div class="sidebar-content" id="mcpServers">
          <div class="empty-state">
            <div class="loading-dots">
              <div class="dot"></div>
              <div class="dot"></div>
              <div class="dot"></div>
            </div>
            Loading servers...
          </div>
        </div>
      </aside>

      <div class="chat-container">
        <!-- Tab Navigation -->
        <div class="tab-nav">
          <button class="tab-btn active" onclick="switchTab('chat')" id="chatTabBtn">
            ğŸ’¬ Chat
          </button>
          <button class="tab-btn" onclick="switchTab('inspector')" id="inspectorTabBtn">
            ğŸ”§ Inspector
          </button>
          <button class="tab-btn" onclick="switchTab('history')" id="historyTabBtn">
            ğŸ“œ History
          </button>
          <button class="tab-btn" onclick="switchTab('scenarios')" id="scenariosTabBtn">
            ğŸ§ª Scenarios
          </button>
          <button class="tab-btn" onclick="switchTab('workflows')" id="workflowsTabBtn">
            â›“ï¸ Workflows
          </button>
          <button class="tab-btn" onclick="switchTab('generator')" id="generatorTabBtn">
            âš™ï¸ Generator
          </button>
        </div>

        <!-- Chat Panel (default) -->
        <div class="content-panel active" id="chatPanel">
          <!-- Chat Header / Toolbar -->
          <div
            style="
              padding: 12px;
              border-bottom: 1px solid var(--border);
              background: var(--bg-card);
              display: flex;
              justify-content: space-between;
              align-items: center;
            "
          >
            <div style="font-weight: 600; display: flex; align-items: center; gap: 8px">
              <span>ğŸ’¬ Chat Session</span>
              <div
                id="connectionStatus"
                style="font-size: 0.7rem; font-weight: normal; color: var(--text-muted)"
              ></div>
            </div>
            <div style="display: flex; gap: 8px">
              <button
                class="btn"
                id="toggleBrainBtn"
                onclick="toggleBrainView()"
                title="Toggle Visualization"
              >
                ğŸ§  Brain View
              </button>
            </div>
          </div>

          <div style="display: flex; flex: 1; overflow: hidden; position: relative">
            <!-- Messages Area -->
            <div class="messages" id="messages" style="flex: 1; overflow-y: auto; padding: 20px">
              <div class="message assistant">
                ğŸ‘‹ Welcome to <strong>MCP Chat Studio</strong>! I'm your AI assistant with MCP tool
                support. Connect to MCP servers using the sidebar to enable powerful tools. Some
                servers may require authentication - click "Login" to connect to secured services.
              </div>
            </div>

            <!-- Brain Visualization Split Pane (Hidden by default) -->
            <div
              id="brainPanel"
              style="
                width: 0;
                transition: width 0.3s ease;
                border-left: 1px solid var(--border);
                background: var(--bg-surface);
                overflow: hidden;
                display: flex;
                flex-direction: column;
              "
            >
              <div
                style="
                  padding: 8px;
                  border-bottom: 1px solid var(--border);
                  font-size: 0.75rem;
                  font-weight: 600;
                  color: var(--text-muted);
                  background: var(--bg-card);
                "
              >
                AGENT EXECUTION TRACE
              </div>
              <div id="brainGraph" style="flex: 1; overflow: auto; position: relative">
                <svg
                  id="brainConnections"
                  style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: 0;
                  "
                ></svg>
                <div
                  id="brainNodesContainer"
                  style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1"
                ></div>
              </div>
            </div>
          </div>

          <div class="input-area">
            <div class="input-container">
              <div class="input-wrapper">
                <textarea
                  id="userInput"
                  placeholder="Type your message... (Enter to send, Shift+Enter for new line)"
                  rows="1"
                ></textarea>
              </div>
              <button class="send-btn" id="sendBtn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="22" y1="2" x2="11" y2="13"></line>
                  <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
                Send
              </button>
            </div>
            <div class="settings-row">
              <label class="toggle">
                <input type="checkbox" id="useTools" checked />
                <span class="switch"></span>
                <span>Use MCP Tools</span>
              </label>
              <label class="toggle">
                <input type="checkbox" id="useStream" checked />
                <span class="switch"></span>
                <span>âš¡ Stream</span>
              </label>
              <!-- System Prompt Selector -->
              <div style="display: flex; align-items: center; gap: 4px">
                <select
                  id="systemPromptSelect"
                  class="form-select"
                  style="font-size: 0.75rem; padding: 4px 8px; min-width: 120px"
                  onchange="changeSystemPrompt(this.value)"
                  title="System Prompt Persona"
                >
                  <!-- Options populated by JS -->
                </select>
                <button
                  class="btn"
                  onclick="showPromptManager()"
                  title="Manage Prompts"
                  style="padding: 4px 6px; font-size: 0.7rem"
                >
                  âœï¸
                </button>
              </div>
              <div id="selectedToolBadge"></div>
            </div>
          </div>
        </div>

        <!-- Inspector Panel -->
        <div class="content-panel" id="inspectorPanel">
          <div class="inspector-panel">
            <!-- Inspector Sub-tabs -->
            <div
              class="inspector-subtabs"
              style="
                display: flex;
                gap: 4px;
                margin-bottom: 12px;
                border-bottom: 1px solid var(--border);
                padding-bottom: 8px;
              "
            >
              <button
                class="btn active"
                id="inspectorToolsTab"
                onclick="switchInspectorTab('tools')"
                style="font-size: 0.75rem; padding: 6px 12px"
              >
                ğŸ”§ Tools
              </button>
              <button
                class="btn"
                id="inspectorResourcesTab"
                onclick="switchInspectorTab('resources')"
                style="font-size: 0.75rem; padding: 6px 12px"
              >
                ğŸ“ Resources
              </button>
              <button
                class="btn"
                id="inspectorPromptsTab"
                onclick="switchInspectorTab('prompts')"
                style="font-size: 0.75rem; padding: 6px 12px"
              >
                ğŸ’¬ Prompts
              </button>
              <button
                class="btn"
                id="inspectorTimelineTab"
                onclick="switchInspectorTab('timeline')"
                style="font-size: 0.75rem; padding: 6px 12px"
              >
                â±ï¸ Timeline
              </button>
              <button
                class="btn"
                id="inspectorBulkTestTab"
                onclick="switchInspectorTab('bulktest')"
                style="font-size: 0.75rem; padding: 6px 12px"
              >
                ğŸ“Š Bulk Test
              </button>
              <button
                class="btn"
                id="inspectorDiffTab"
                onclick="switchInspectorTab('diff')"
                style="font-size: 0.75rem; padding: 6px 12px"
              >
                ğŸ”€ Diff
              </button>
            </div>

            <!-- Tools Sub-panel (default) -->
            <div id="inspectorToolsPanel">
              <!-- Tool Selector -->
              <div class="inspector-section">
                <h3>ğŸ”§ Select Tool</h3>
                <div class="inspector-toolbar">
                  <select
                    class="form-select"
                    id="inspectorServerSelect"
                    onchange="loadInspectorTools()"
                  >
                    <option value="">-- Select Server --</option>
                  </select>
                  <select
                    class="form-select"
                    id="inspectorToolSelect"
                    onchange="generateInspectorForm()"
                  >
                    <option value="">-- Select Tool --</option>
                  </select>
                </div>
              </div>

              <!-- Input Form -->
              <div class="inspector-section" id="inspectorFormSection" style="display: none">
                <h3>ğŸ“ Input Parameters</h3>
                <div
                  id="inspectorToolDescription"
                  style="
                    font-size: 0.8rem;
                    color: var(--text-secondary);
                    margin-bottom: var(--spacing-md);
                  "
                ></div>
                <div class="inspector-form" id="inspectorForm">
                  <!-- Dynamic fields will be generated here -->
                </div>
                <div style="margin-top: var(--spacing-md); display: flex; gap: var(--spacing-sm)">
                  <button
                    class="btn primary"
                    onclick="executeInspectorTool()"
                    id="inspectorExecuteBtn"
                  >
                    â–¶ï¸ Execute
                  </button>
                  <button class="btn" onclick="clearInspectorForm()">ğŸ—‘ï¸ Clear</button>
                </div>
              </div>

              <!-- Response Display -->
              <div class="inspector-section" id="inspectorResponseSection" style="display: none">
                <h3>ğŸ“¤ Response</h3>
                <div class="inspector-response-header" id="inspectorResponseHeader">
                  <div class="inspector-status" id="inspectorResponseStatus"></div>
                  <button
                    class="btn"
                    onclick="copyInspectorResponse()"
                    style="font-size: 0.7rem; padding: 2px 8px"
                  >
                    ğŸ“‹ Copy JSON
                  </button>
                </div>
                <div class="inspector-response" id="inspectorResponseBody"></div>
              </div>

              <!-- Protocol Log -->
              <div class="inspector-section">
                <h3 style="display: flex; justify-content: space-between; align-items: center">
                  <span>ğŸ“œ Protocol Log</span>
                  <button
                    class="btn"
                    onclick="clearProtocolLog()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ—‘ï¸ Clear
                  </button>
                </h3>
                <div
                  id="protocolLog"
                  style="max-height: 300px; overflow-y: auto; font-size: 0.75rem"
                >
                  <div style="color: var(--text-muted); font-style: italic">
                    Execute a tool to see protocol messages...
                  </div>
                </div>
              </div>

              <!-- SSE Events Viewer -->
              <div class="inspector-section">
                <h3 style="display: flex; justify-content: space-between; align-items: center">
                  <span>ğŸ“¡ SSE Events</span>
                  <div style="display: flex; gap: 4px">
                    <button
                      id="sseConnectBtn"
                      class="btn"
                      onclick="toggleSSEViewer()"
                      style="font-size: 0.65rem; padding: 2px 6px"
                    >
                      ğŸ”Œ Connect
                    </button>
                    <button
                      class="btn"
                      onclick="clearSSEEvents()"
                      style="font-size: 0.65rem; padding: 2px 6px"
                    >
                      ğŸ—‘ï¸ Clear
                    </button>
                  </div>
                </h3>
                <div
                  id="sseStatus"
                  style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 4px"
                >
                  Not connected - select an SSE server and click Connect
                </div>
                <div id="sseEvents" style="max-height: 250px; overflow-y: auto; font-size: 0.75rem">
                  <div style="color: var(--text-muted); font-style: italic">
                    Connect to an SSE server to see real-time events...
                  </div>
                </div>
              </div>
            </div>
            <!-- End Tools Sub-panel -->

            <!-- Resources Sub-panel -->
            <div id="inspectorResourcesPanel" style="display: none">
              <div class="inspector-section">
                <h3>ğŸ“ MCP Resources</h3>
                <div class="inspector-toolbar">
                  <select
                    class="form-select"
                    id="resourceServerSelect"
                    onchange="loadServerResources()"
                  >
                    <option value="">-- Select Server --</option>
                  </select>
                  <button
                    class="btn"
                    onclick="loadServerResources()"
                    style="font-size: 0.75rem; padding: 4px 8px"
                  >
                    ğŸ”„ Reload
                  </button>
                </div>
              </div>
              <div class="inspector-section">
                <div id="resourcesList" style="max-height: 400px; overflow-y: auto">
                  <div style="color: var(--text-muted); font-style: italic; padding: 12px">
                    Select a server to view available resources...
                  </div>
                </div>
              </div>
              <div class="inspector-section" id="resourceContentSection" style="display: none">
                <h3 style="display: flex; justify-content: space-between; align-items: center">
                  <span>ğŸ“„ Resource Content</span>
                  <button
                    class="btn"
                    onclick="copyResourceContent()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ“‹ Copy
                  </button>
                </h3>
                <div
                  id="resourceContent"
                  style="
                    background: var(--bg-card);
                    padding: 12px;
                    border-radius: 8px;
                    max-height: 300px;
                    overflow: auto;
                  "
                >
                  <pre style="margin: 0; white-space: pre-wrap; font-size: 0.75rem"></pre>
                </div>
              </div>
            </div>

            <!-- Prompts Sub-panel -->
            <div id="inspectorPromptsPanel" style="display: none">
              <div class="inspector-section">
                <h3>ğŸ’¬ MCP Prompts</h3>
                <div class="inspector-toolbar">
                  <select
                    class="form-select"
                    id="promptServerSelect"
                    onchange="loadServerPrompts()"
                  >
                    <option value="">-- Select Server --</option>
                  </select>
                  <button
                    class="btn"
                    onclick="loadServerPrompts()"
                    style="font-size: 0.75rem; padding: 4px 8px"
                  >
                    ğŸ”„ Reload
                  </button>
                </div>
              </div>
              <div class="inspector-section">
                <div id="promptsList" style="max-height: 400px; overflow-y: auto">
                  <div style="color: var(--text-muted); font-style: italic; padding: 12px">
                    Select a server to view available prompts...
                  </div>
                </div>
              </div>
              <div class="inspector-section" id="promptPreviewSection" style="display: none">
                <h3 style="display: flex; justify-content: space-between; align-items: center">
                  <span>ğŸ“ Prompt Preview</span>
                  <button
                    class="btn success"
                    onclick="usePromptInChat()"
                    style="font-size: 0.65rem; padding: 2px 8px"
                  >
                    ğŸ’¬ Use in Chat
                  </button>
                </h3>
                <div
                  id="promptPreview"
                  style="
                    background: var(--bg-card);
                    padding: 12px;
                    border-radius: 8px;
                    max-height: 300px;
                    overflow: auto;
                  "
                >
                  <pre style="margin: 0; white-space: pre-wrap; font-size: 0.75rem"></pre>
                </div>
              </div>
            </div>

            <!-- Timeline Sub-panel -->
            <div id="inspectorTimelinePanel" style="display: none">
              <div class="inspector-section">
                <h3 style="display: flex; justify-content: space-between; align-items: center">
                  <span>â±ï¸ Message Timeline</span>
                  <div style="display: flex; gap: 4px">
                    <button class="btn" onclick="startTimeline()" style="font-size: 0.65rem; padding: 2px 6px">â–¶ï¸ Start</button>
                    <button class="btn" onclick="refreshTimeline()" style="font-size: 0.65rem; padding: 2px 6px">ğŸ”„ Refresh</button>
                    <button class="btn" onclick="exportTimeline()" style="font-size: 0.65rem; padding: 2px 6px">ğŸ“¥ Export</button>
                    <button class="btn" onclick="clearTimeline()" style="font-size: 0.65rem; padding: 2px 6px">ğŸ—‘ï¸ Clear</button>
                  </div>
                </h3>
                <div style="margin-bottom: 12px">
                  <div style="display: flex; gap: 8px; align-items: center; font-size: 0.75rem">
                    <span>Filter:</span>
                    <select class="form-select" id="timelineServerFilter" onchange="refreshTimeline()" style="flex: 1; max-width: 200px">
                      <option value="">All Servers</option>
                    </select>
                    <select class="form-select" id="timelineTypeFilter" onchange="refreshTimeline()" style="flex: 1; max-width: 150px">
                      <option value="">All Types</option>
                      <option value="request">Requests</option>
                      <option value="response">Responses</option>
                      <option value="error">Errors</option>
                    </select>
                  </div>
                </div>
                <div id="timelineSessionStatus" style="font-size: 0.7rem; color: var(--text-muted); margin-bottom: 8px">
                  Not tracking. Click "Start" to begin capturing messages.
                </div>
                <div id="timelineEvents" style="max-height: 500px; overflow-y: auto; font-size: 0.75rem">
                  <div style="color: var(--text-muted); font-style: italic; padding: 12px">
                    Start timeline tracking to see chronological message flow...
                  </div>
                </div>
              </div>
            </div>

            <!-- Bulk Test Sub-panel -->
            <div id="inspectorBulkTestPanel" style="display: none">
              <div class="inspector-section">
                <h3>ğŸ“Š Bulk Test</h3>
                <p style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 12px">
                  Execute a tool with multiple inputs and compare results
                </p>
                <div class="inspector-toolbar" style="margin-bottom: 12px">
                  <select class="form-select" id="bulkTestServerSelect" onchange="loadBulkTestTools()">
                    <option value="">-- Select Server --</option>
                  </select>
                  <select class="form-select" id="bulkTestToolSelect">
                    <option value="">-- Select Tool --</option>
                  </select>
                </div>
                <div style="margin-bottom: 12px">
                  <label style="font-size: 0.8rem; font-weight: 500; display: block; margin-bottom: 4px">Test Inputs (JSON array of objects):</label>
                  <textarea
                    id="bulkTestInputs"
                    class="form-control"
                    rows="8"
                    placeholder='[
  {"param1": "value1", "param2": "value2"},
  {"param1": "value3", "param2": "value4"},
  {"param1": "value5", "param2": "value6"}
]'
                    style="font-family: 'Courier New', monospace; font-size: 0.75rem"
                  ></textarea>
                </div>
                <div style="display: flex; gap: 8px; align-items: center; margin-bottom: 12px; font-size: 0.75rem">
                  <label style="display: flex; align-items: center; gap: 4px">
                    <input type="checkbox" id="bulkTestParallel" checked />
                    Run in parallel
                  </label>
                  <label style="display: flex; align-items: center; gap: 4px">
                    <input type="checkbox" id="bulkTestContinueOnError" checked />
                    Continue on error
                  </label>
                </div>
                <button class="btn primary" onclick="runBulkTest()" id="bulkTestRunBtn">â–¶ï¸ Run Bulk Test</button>
              </div>
              <div class="inspector-section" id="bulkTestResultsSection" style="display: none">
                <h3 style="display: flex; justify-content: space-between; align-items: center">
                  <span>ğŸ“ˆ Results</span>
                  <button class="btn" onclick="exportBulkTestResults()" style="font-size: 0.65rem; padding: 2px 6px">ğŸ“¥ Export</button>
                </h3>
                <div id="bulkTestSummary" style="margin-bottom: 12px; padding: 12px; background: var(--bg-card); border-radius: 8px; font-size: 0.75rem"></div>
                <div id="bulkTestResults" style="max-height: 400px; overflow-y: auto; font-size: 0.75rem"></div>
              </div>
            </div>

            <!-- Diff Sub-panel -->
            <div id="inspectorDiffPanel" style="display: none">
              <div class="inspector-section">
                <h3>ğŸ”€ Result Diff</h3>
                <p style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 12px">
                  Compare two tool call results side-by-side
                </p>
                <div class="inspector-toolbar" style="margin-bottom: 12px">
                  <select class="form-select" id="diffServerSelect" onchange="loadDiffTools()">
                    <option value="">-- Select Server --</option>
                  </select>
                  <select class="form-select" id="diffToolSelect">
                    <option value="">-- Select Tool --</option>
                  </select>
                </div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 12px; margin-bottom: 12px">
                  <div>
                    <label style="font-size: 0.8rem; font-weight: 500; display: block; margin-bottom: 4px">Args A:</label>
                    <textarea
                      id="diffArgs1"
                      class="form-control"
                      rows="6"
                      placeholder='{"param": "value1"}'
                      style="font-family: 'Courier New', monospace; font-size: 0.75rem"
                    ></textarea>
                  </div>
                  <div>
                    <label style="font-size: 0.8rem; font-weight: 500; display: block; margin-bottom: 4px">Args B:</label>
                    <textarea
                      id="diffArgs2"
                      class="form-control"
                      rows="6"
                      placeholder='{"param": "value2"}'
                      style="font-family: 'Courier New', monospace; font-size: 0.75rem"
                    ></textarea>
                  </div>
                </div>
                <button class="btn primary" onclick="runDiff()" id="diffRunBtn">ğŸ”€ Compare</button>
              </div>
              <div class="inspector-section" id="diffResultsSection" style="display: none">
                <h3 style="display: flex; justify-content: space-between; align-items: center">
                  <span>ğŸ“Š Comparison</span>
                  <div id="diffSimilarity" style="font-size: 0.75rem"></div>
                </h3>
                <div id="diffResults" style="font-size: 0.75rem"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- History Panel -->
        <div class="content-panel" id="historyPanel">
          <div class="inspector-panel">
            <div class="inspector-section">
              <h3 style="display: flex; justify-content: space-between; align-items: center">
                <span>ğŸ“œ Tool Execution History</span>
                <div style="display: flex; gap: 4px">
                  <button
                    class="btn"
                    onclick="refreshHistoryPanel()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ”„ Refresh
                  </button>
                  <button
                    class="btn"
                    onclick="exportToolHistory()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ“¥ Export
                  </button>
                  <button
                    class="btn"
                    onclick="clearToolHistory()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ—‘ï¸ Clear
                  </button>
                </div>
              </h3>
              <div
                id="toolHistoryStats"
                style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px"
              >
                No tool executions recorded
              </div>
            </div>
            <div
              id="toolHistoryList"
              style="
                display: flex;
                flex-direction: column;
                gap: 8px;
                overflow-y: auto;
                max-height: calc(100vh - 280px);
              "
            >
              <div
                style="
                  color: var(--text-muted);
                  font-style: italic;
                  text-align: center;
                  padding: 20px;
                "
              >
                Execute tools from the Inspector tab to see history here...
              </div>
            </div>
          </div>
        </div>

        <!-- Scenarios Panel -->
        <div class="content-panel" id="scenariosPanel">
          <!-- ... (content omitted for brevity) ... -->
          <div class="inspector-panel">
            <!-- Recording Status -->
            <div class="inspector-section" id="recordingSection">
              <h3 style="display: flex; justify-content: space-between; align-items: center">
                <span>ğŸ¬ Recording</span>
                <div style="display: flex; gap: 4px">
                  <button
                    id="recordBtn"
                    class="btn"
                    onclick="toggleRecording()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ”´ Start Recording
                  </button>
                </div>
              </h3>
              <div id="recordingStatus" style="font-size: 0.75rem; color: var(--text-muted)">
                Not recording. Click "Start Recording" then execute tools in Inspector.
              </div>
              <div id="recordingSteps" style="display: none; margin-top: 8px; font-size: 0.75rem">
                <div style="font-weight: 500; margin-bottom: 4px">Recorded Steps:</div>
                <div id="recordingStepsList"></div>
              </div>
            </div>

            <!-- Test Suites Section -->
            <div class="inspector-section">
              <h3 style="display: flex; justify-content: space-between; align-items: center">
                <span>ğŸ“¦ Test Suites</span>
                <div style="display: flex; gap: 4px">
                  <button
                    class="btn"
                    onclick="showCreateSuiteModal()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    â• New Suite
                  </button>
                </div>
              </h3>
              <div id="suitesList" style="font-size: 0.75rem">
                <div style="color: var(--text-muted)">No test suites created yet.</div>
              </div>
            </div>

            <!-- Saved Scenarios -->
            <div class="inspector-section">
              <h3 style="display: flex; justify-content: space-between; align-items: center">
                <span>ğŸ§ª Saved Scenarios</span>
                <div style="display: flex; gap: 4px">
                  <button
                    class="btn"
                    onclick="refreshScenariosPanel()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ”„ Refresh
                  </button>
                  <button
                    class="btn"
                    onclick="exportAllScenarios()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ“¥ Export All
                  </button>
                </div>
              </h3>
              <div
                id="scenariosStats"
                style="font-size: 0.75rem; color: var(--text-muted); margin-bottom: 8px"
              >
                No scenarios saved
              </div>
            </div>
            <div
              id="scenariosList"
              style="
                display: flex;
                flex-direction: column;
                gap: 8px;
                overflow-y: auto;
                max-height: calc(100vh - 350px);
              "
            >
              <div
                style="
                  color: var(--text-muted);
                  font-style: italic;
                  text-align: center;
                  padding: 20px;
                "
              >
                Record tool executions from Inspector â†’ Save as Scenario â†’ Replay anytime
              </div>
            </div>
          </div>
        </div>

        <!-- Workflows Panel -->
        <div class="content-panel" id="workflowsPanel">
          <div style="display: flex; height: 100%; overflow: hidden">
            <!-- Workflow Sidebar -->
            <div
              style="
                width: 250px;
                border-right: 1px solid var(--border);
                padding: 12px;
                display: flex;
                flex-direction: column;
                background: var(--bg-card);
              "
            >
              <h3 style="margin-bottom: 12px; font-size: 1rem">â›“ï¸ Workflows</h3>

              <button
                class="btn primary"
                onclick="createNewWorkflow()"
                style="width: 100%; margin-bottom: 12px"
              >
                + New Workflow
              </button>

              <div
                style="
                  margin-bottom: 8px;
                  font-size: 0.75rem;
                  font-weight: 500;
                  color: var(--text-muted);
                "
              >
                SAVED WORKFLOWS
              </div>
              <div
                id="workflowList"
                style="flex: 1; overflow-y: auto; display: flex; flex-direction: column; gap: 4px"
              >
                <div style="color: var(--text-muted); font-size: 0.75rem; font-style: italic">
                  Loading...
                </div>
              </div>
            </div>

            <!-- Workflow Canvas Area -->
            <div style="flex: 1; display: flex; flex-direction: column; position: relative">
              <!-- Toolbar -->
              <div
                style="
                  padding: 8px;
                  border-bottom: 1px solid var(--border);
                  background: var(--bg-surface);
                  display: flex;
                  gap: 8px;
                  align-items: center;
                "
              >
                <input
                  type="text"
                  id="workflowName"
                  class="form-input"
                  placeholder="Workflow Name"
                  style="width: 200px"
                />
                <button class="btn" onclick="addNode('tool')">â• Tool Node</button>
                <button class="btn" onclick="addNode('llm')">â• LLM Node</button>
                <button class="btn" onclick="addNode('javascript')">â• JS Node</button>
                <button class="btn" onclick="addNode('assert')" style="background: rgba(34, 197, 94, 0.2); border-color: var(--success);">âœ“ Assert</button>
                <div
                  style="width: 1px; height: 20px; background: var(--border); margin: 0 8px"
                ></div>
                <button class="btn success" onclick="toggleAIBuilder()" title="Build with AI">
                  âœ¨ AI Builder
                </button>
                <button
                  class="btn"
                  onclick="showExportModal()"
                  title="Export as Python Script"
                  style="margin-left: 8px"
                >
                  ğŸ“¤ Export Code
                </button>

                <!-- LLM Model Indicator -->
                <div
                  id="workflowModelBadge"
                  onclick="showSettingsModal()"
                  style="
                    display: flex;
                    align-items: center;
                    gap: 4px;
                    padding: 4px 10px;
                    background: var(--bg-card);
                    border: 1px solid var(--border);
                    border-radius: 16px;
                    cursor: pointer;
                    font-size: 0.7rem;
                  "
                  title="LLM nodes will use this model. Click to change."
                >
                  <span id="workflowModelIcon">ğŸ¦™</span>
                  <span id="workflowModelName">Loading...</span>
                </div>

                <div style="flex: 1"></div>
                <button class="btn primary" onclick="runWorkflow()">â–¶ï¸ Run</button>
                <button class="btn" onclick="saveWorkflow()">ğŸ’¾ Save</button>
              </div>

              <!-- Canvas -->
              <div
                id="workflowCanvas"
                style="
                  flex: 1;
                  position: relative;
                  overflow: auto;
                  background: var(--bg-surface);
                  background-image: radial-gradient(var(--border) 1px, transparent 1px);
                  background-size: 20px 20px;
                "
              >
                <!-- Nodes will be added here -->
                <svg
                  id="workflowConnections"
                  style="
                    position: absolute;
                    top: 0;
                    left: 0;
                    width: 100%;
                    height: 100%;
                    pointer-events: none;
                    z-index: 0;
                  "
                ></svg>
              </div>

              <!-- Execution Log -->
              <div
                id="workflowLogs"
                style="
                  height: 200px;
                  border-top: 1px solid var(--border);
                  background: var(--bg-card);
                  display: none;
                  flex-direction: column;
                "
              >
                <div
                  style="
                    padding: 8px;
                    border-bottom: 1px solid var(--border);
                    display: flex;
                    justify-content: space-between;
                  "
                >
                  <span style="font-weight: 500">Execution Log</span>
                  <button
                    class="btn"
                    onclick="document.getElementById('workflowLogs').style.display = 'none'"
                    style="font-size: 0.7rem"
                  >
                    âœ•
                  </button>
                </div>
                <div
                  id="workflowLogContent"
                  style="
                    flex: 1;
                    overflow-y: auto;
                    padding: 8px;
                    font-family: monospace;
                    font-size: 0.8rem;
                  "
                ></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Generator Panel -->
        <div class="content-panel" id="generatorPanel">
          <div class="inspector-panel">
            <div class="inspector-section">
              <h3>âš™ï¸ Mock MCP Server Generator</h3>
              <p style="font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 12px">
                Design tools visually and generate Python or Node.js starter code for your own MCP
                server.
              </p>
            </div>

            <!-- Server Settings -->
            <div class="inspector-section">
              <h3>ğŸ“‹ Server Settings</h3>
              <div style="display: flex; flex-direction: column; gap: 8px">
                <div>
                  <label style="font-size: 0.75rem; font-weight: 500">Server Name</label>
                  <input
                    type="text"
                    id="genServerName"
                    class="form-input"
                    placeholder="my-mcp-server"
                    style="width: 100%"
                  />
                </div>
                <div>
                  <label style="font-size: 0.75rem; font-weight: 500">Description</label>
                  <input
                    type="text"
                    id="genServerDesc"
                    class="form-input"
                    placeholder="A custom MCP server"
                    style="width: 100%"
                  />
                </div>
                <div>
                  <label style="font-size: 0.75rem; font-weight: 500">Output Language</label>
                  <select id="genLanguage" class="form-select" style="width: 100%">
                    <option value="python">Python (mcp SDK)</option>
                    <option value="nodejs">Node.js (TypeScript)</option>
                  </select>
                </div>
              </div>
            </div>

            <!-- Tool Designer -->
            <div class="inspector-section">
              <h3 style="display: flex; justify-content: space-between; align-items: center">
                <span>ğŸ”§ Tool Designer</span>
                <button
                  class="btn"
                  onclick="addGeneratorTool()"
                  style="font-size: 0.65rem; padding: 2px 8px"
                >
                  â• Add Tool
                </button>
              </h3>
              <div
                id="generatorToolsList"
                style="
                  display: flex;
                  flex-direction: column;
                  gap: 8px;
                  max-height: 250px;
                  overflow-y: auto;
                "
              >
                <div
                  style="
                    color: var(--text-muted);
                    font-style: italic;
                    padding: 12px;
                    text-align: center;
                  "
                >
                  No tools defined. Click "Add Tool" to start designing.
                </div>
              </div>
            </div>

            <!-- Generate Actions -->
            <div class="inspector-section">
              <div style="display: flex; gap: 8px; flex-wrap: wrap">
                <button class="btn primary" onclick="generateMCPCode()" style="flex: 1">
                  ğŸš€ Generate Code
                </button>
                <button class="btn" onclick="previewMCPCode()" style="flex: 1">ğŸ‘ï¸ Preview</button>
                <button class="btn" onclick="clearGenerator()">ğŸ—‘ï¸ Clear</button>
              </div>
            </div>

            <!-- Code Preview -->
            <div class="inspector-section" id="generatorPreviewSection" style="display: none">
              <h3 style="display: flex; justify-content: space-between; align-items: center">
                <span>ğŸ“„ Generated Code</span>
                <div style="display: flex; gap: 4px">
                  <button
                    class="btn"
                    onclick="copyGeneratedCode()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ“‹ Copy
                  </button>
                  <button
                    class="btn success"
                    onclick="downloadGeneratedCode()"
                    style="font-size: 0.65rem; padding: 2px 6px"
                  >
                    ğŸ“¥ Download
                  </button>
                </div>
              </h3>
              <pre
                id="generatorCodePreview"
                style="
                  background: var(--bg-card);
                  padding: 12px;
                  border-radius: 8px;
                  overflow: auto;
                  max-height: 300px;
                  font-size: 0.7rem;
                "
              ></pre>
            </div>
          </div>
        </div>
      </div>
    </main>

    <!-- AI Workflow Builder Sidebar -->
    <div
      id="aiBuilderSidebar"
      style="
        position: absolute;
        top: 56px;
        right: 0;
        bottom: 0;
        width: 400px;
        background: var(--bg-card);
        border-left: 1px solid var(--border);
        box-shadow: -4px 0 20px rgba(0, 0, 0, 0.2);
        transform: translateX(100%);
        transition: transform 0.3s ease;
        z-index: 50;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      "
    >
      <div
        style="
          padding: 12px;
          border-bottom: 1px solid var(--border);
          display: flex;
          justify-content: space-between;
          align-items: center;
          background: var(--bg-surface);
        "
      >
        <h3
          style="font-size: 0.9rem; font-weight: 600; display: flex; align-items: center; gap: 6px"
        >
          âœ¨ AI Builder
          <span
            id="aiModelBadge"
            style="
              font-size: 0.65rem;
              background: var(--bg-surface);
              padding: 2px 6px;
              border-radius: 10px;
              border: 1px solid var(--border);
              font-weight: normal;
            "
            >Loading...</span
          >
        </h3>
        <button class="btn" onclick="toggleAIBuilder()" style="font-size: 0.7rem; padding: 4px 8px">
          âœ•
        </button>
      </div>

      <div
        style="
          flex: 1;
          padding: 16px;
          overflow-y: auto;
          display: flex;
          flex-direction: column;
          gap: 12px;
        "
      >
        <div class="message system" style="font-size: 0.8rem">
          Describe your testing goal. I'll build a workflow using your
          <strong>connected tools</strong>.
        </div>

        <div class="form-group">
          <label class="form-label">Goal</label>
          <textarea
            id="aiBuilderPrompt"
            class="form-input"
            rows="6"
            placeholder="e.g. Call 'list_files' on the filesystem server, then loop through them and check if 'package.json' exists using an LLM node."
            style="resize: vertical"
          ></textarea>
        </div>

        <div
          id="aiBuilderStatus"
          style="font-size: 0.75rem; color: var(--text-muted); min-height: 20px"
        ></div>
      </div>

      <div
        style="padding: 12px; border-top: 1px solid var(--border); background: var(--bg-surface)"
      >
        <button class="btn primary" onclick="generateWorkflow()" style="width: 100%">
          ğŸš€ Generate Workflow
        </button>
      </div>
    </div>

    <!-- Export Code Modal -->
    <div class="modal-overlay" id="exportCodeModal">
      <div
        class="modal"
        style="max-width: 800px; height: 80vh; display: flex; flex-direction: column"
      >
        <div class="modal-header">
          <h2 class="modal-title">ğŸ“¤ Export Workflow as Code</h2>
          <button class="modal-close" onclick="hideExportModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <div
          style="
            padding: 12px;
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 8px;
            align-items: center;
          "
        >
          <select id="exportFormat" class="form-select" onchange="generateExportCode()">
            <option value="python">ğŸ Python (mcp SDK)</option>
            <option value="nodejs">ğŸ“¦ Node.js (Coming Soon)</option>
          </select>
          <div style="flex: 1"></div>
          <button class="btn" onclick="copyExportCode()">ğŸ“‹ Copy to Clipboard</button>
          <button class="btn primary" onclick="downloadExportCode()">ğŸ“¥ Download File</button>
        </div>

        <div style="flex: 1; overflow: hidden; position: relative">
          <textarea
            id="exportCodePreview"
            style="
              width: 100%;
              height: 100%;
              border: none;
              padding: 16px;
              background: var(--bg-surface);
              color: var(--text-primary);
              font-family: 'JetBrains Mono', monospace;
              font-size: 0.8rem;
              resize: none;
            "
            readonly
          ></textarea>
        </div>
      </div>
    </div>

    <!-- Add Server Modal -->
    <div class="modal-overlay" id="addServerModal">
      <div class="modal" style="max-width: 600px">
        <div class="modal-header">
          <h2 class="modal-title">Add MCP Server</h2>
          <button class="modal-close" onclick="hideAddServerModal()">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              style="width: 20px; height: 20px"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <!-- Server Templates -->
        <div style="margin-bottom: var(--spacing-md)">
          <label class="form-label">ğŸ“¦ Quick Templates</label>
          <div style="display: flex; gap: var(--spacing-sm)">
            <select
              class="form-select"
              id="serverTemplate"
              onchange="applyServerTemplate()"
              style="flex: 1"
            >
              <option value="">-- Select a template --</option>
              <optgroup label="Official MCP Servers">
                <option value="github">ğŸ™ GitHub (requires token)</option>
                <option value="filesystem">ğŸ“ Filesystem (local access)</option>
                <option value="brave-search">ğŸ” Brave Search (requires API key)</option>
                <option value="sqlite">ğŸ—„ï¸ SQLite (local database)</option>
                <option value="puppeteer">ğŸ­ Puppeteer (browser automation)</option>
              </optgroup>
              <optgroup label="SSE Examples">
                <option value="sse-example">ğŸŒ SSE Server (example URL)</option>
              </optgroup>
              <optgroup
                id="customTemplatesGroup"
                label="ğŸ“Œ My Templates"
                style="display: none"
              ></optgroup>
            </select>
            <button
              type="button"
              class="btn"
              onclick="saveAsCustomTemplate()"
              title="Save current form as template"
              style="white-space: nowrap"
            >
              ğŸ’¾ Save
            </button>
            <button
              type="button"
              class="btn"
              onclick="manageCustomTemplates()"
              title="Delete custom templates"
              style="white-space: nowrap"
            >
              ğŸ—‘ï¸
            </button>
          </div>
          <div class="form-hint">
            Select a template to auto-fill, save your own ğŸ’¾, or delete ğŸ—‘ï¸
          </div>
        </div>

        <!-- Import YAML/JSON Button -->
        <div style="margin-bottom: var(--spacing-md); display: flex; gap: var(--spacing-sm)">
          <button type="button" class="btn" onclick="showImportConfigModal()" style="flex: 1">
            ğŸ“‹ Import YAML/JSON
          </button>
        </div>

        <form id="addServerForm" onsubmit="submitAddServer(event)">
          <div class="form-group">
            <label class="form-label">Server Name *</label>
            <input
              type="text"
              class="form-input"
              id="serverName"
              placeholder="my-mcp-server"
              required
              oninput="updateConfigPreview()"
            />
            <div class="form-hint">A unique identifier for this server</div>
          </div>

          <div class="form-group">
            <label class="form-label">Transport *</label>
            <select
              class="form-select"
              id="serverType"
              onchange="
                toggleServerTypeFields();
                updateConfigPreview();
              "
            >
              <option value="stdio">STDIO (spawn local process)</option>
              <option value="sse">SSE (HTTP endpoint)</option>
            </select>
          </div>

          <div id="stdioFields">
            <div class="form-group">
              <label class="form-label">Command *</label>
              <input
                type="text"
                class="form-input"
                id="serverCommand"
                placeholder="python"
                oninput="updateConfigPreview()"
              />
              <div class="form-hint">
                Use python, node, npx, or an absolute path to an executable
              </div>
            </div>

            <div class="form-group">
              <label class="form-label">Arguments</label>
              <textarea
                class="form-input"
                id="serverArgs"
                rows="2"
                placeholder="-m my_module&#10;--port 8080"
                oninput="updateConfigPreview()"
              ></textarea>
              <div class="form-hint">One argument per line. We'll pass them exactly as argv.</div>
            </div>
          </div>

          <div id="sseFields" style="display: none">
            <div class="form-group">
              <label class="form-label">URL *</label>
              <input
                type="url"
                class="form-input"
                id="serverUrl"
                placeholder="http://localhost:8000/sse"
                oninput="updateConfigPreview()"
              />
              <div class="form-hint">The SSE endpoint URL for the MCP server</div>
            </div>
          </div>

          <!-- Environment Variables Section -->
          <div class="form-group">
            <label class="form-label">Environment Variables</label>
            <div id="envVarsContainer">
              <!-- Dynamic rows will be added here -->
            </div>
            <button
              type="button"
              class="btn"
              onclick="addEnvVarRow()"
              style="margin-top: var(--spacing-xs); font-size: 0.8rem"
            >
              + Add Variable
            </button>
            <div class="form-hint">Add API keys, URLs, or other environment variables</div>
          </div>

          <div class="form-group">
            <label class="form-label">Description (optional)</label>
            <input
              type="text"
              class="form-input"
              id="serverDescription"
              placeholder="My custom MCP server"
            />
          </div>

          <!-- Config Preview -->
          <div class="form-group">
            <label
              class="form-label"
              style="display: flex; justify-content: space-between; align-items: center"
            >
              <span>Generated Config Preview</span>
              <button
                type="button"
                class="btn"
                onclick="copyConfigToClipboard()"
                style="font-size: 0.7rem; padding: 2px 8px"
              >
                ğŸ“‹ Copy YAML
              </button>
            </label>
            <pre
              id="configPreview"
              style="
                background: var(--bg-surface);
                border: 1px solid var(--border-default);
                border-radius: var(--radius-md);
                padding: var(--spacing-sm);
                font-size: 0.75rem;
                font-family: 'JetBrains Mono', monospace;
                max-height: 150px;
                overflow-y: auto;
                white-space: pre-wrap;
                color: var(--text-secondary);
              "
            ></pre>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn" onclick="hideAddServerModal()">Cancel</button>
            <button type="submit" class="btn primary" id="addServerSubmitBtn">Add Server</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Import Config Modal -->
    <div class="modal-overlay" id="importConfigModal">
      <div class="modal" style="max-width: 550px">
        <div class="modal-header">
          <h2 class="modal-title">ğŸ“‹ Import Config</h2>
          <button class="modal-close" onclick="hideImportConfigModal()">
            <svg
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              style="width: 20px; height: 20px"
            >
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <div class="form-group">
          <label class="form-label">Paste YAML or JSON config</label>
          <textarea
            class="form-input"
            id="importConfigText"
            rows="10"
            placeholder="command: python
args:
  - -m
  - my_mcp_server
env:
  API_KEY: your-key-here"
          ></textarea>
          <div class="form-hint">
            Supports single server config or full mcpServers object. We'll parse and fill the form.
          </div>
        </div>
        <div class="modal-actions">
          <button type="button" class="btn" onclick="hideImportConfigModal()">Cancel</button>
          <button type="button" class="btn primary" onclick="parseAndImportConfig()">Import</button>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal-overlay" id="settingsModal">
      <div class="modal">
        <div class="modal-header">
          <h2 class="modal-title">âš™ï¸ LLM Settings</h2>
          <button class="modal-close" onclick="hideSettingsModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>

        <form id="settingsForm" onsubmit="saveSettings(event)">
          <div class="form-group">
            <label class="form-label">Provider *</label>
            <select class="form-select" id="llmProvider" onchange="onProviderChange()">
              <option value="ollama">ğŸ¦™ Ollama (Local)</option>
              <option value="openai">ğŸ¤– OpenAI</option>
              <option value="anthropic">ğŸ­ Anthropic Claude</option>
              <option value="gemini">ğŸ’ Google Gemini</option>
              <option value="azure">â˜ï¸ Azure OpenAI</option>
              <option value="groq">âš¡ Groq</option>
              <option value="together">ğŸ¤ Together AI</option>
              <option value="openrouter">ğŸŒ OpenRouter</option>
            </select>
            <div class="form-hint" id="providerHint">Local LLM server - no API key needed</div>
          </div>

          <div class="form-group">
            <label class="form-label">Model *</label>
            <input type="text" class="form-input" id="llmModel" placeholder="llama2" />
            <div class="form-hint">Model name (e.g., llama2, gpt-4, mistral)</div>
          </div>

          <div class="form-group">
            <label class="form-label">Temperature</label>
            <div style="display: flex; align-items: center; gap: var(--spacing-md)">
              <input
                type="range"
                id="llmTemperature"
                min="0"
                max="2"
                step="0.1"
                value="0.7"
                style="flex: 1"
              />
              <span id="tempValue" style="min-width: 40px; text-align: center">0.7</span>
            </div>
            <div class="form-hint">0 = precise, 1 = creative, 2 = very random</div>
          </div>

          <div class="form-group">
            <label class="form-label">Base URL (optional)</label>
            <input
              type="url"
              class="form-input"
              id="llmBaseUrl"
              placeholder="http://localhost:11434/v1"
            />
            <div class="form-hint">Custom API endpoint URL</div>
          </div>

          <div class="form-group" id="apiKeyGroup" style="display: none">
            <label class="form-label">API Key</label>
            <input type="password" class="form-input" id="llmApiKey" placeholder="sk-..." />
            <div class="form-hint">Your OpenAI API key (stored in session only)</div>
          </div>

          <div class="modal-actions">
            <button type="button" class="btn" onclick="hideSettingsModal()">Cancel</button>
            <button type="submit" class="btn primary">Save Settings</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Confirm Delete Modal -->
    <div class="modal-overlay" id="confirmDeleteModal">
      <div class="modal" style="max-width: 400px">
        <div class="modal-header">
          <h2 class="modal-title">ğŸ—‘ï¸ Remove Server</h2>
          <button class="modal-close" onclick="hideConfirmDeleteModal()">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        </div>
        <p style="margin: var(--spacing-md) 0; color: var(--text-secondary)">
          Remove server "<span
            id="deleteServerName"
            style="color: var(--text-primary); font-weight: 500"
          ></span
          >"?
        </p>
        <p style="margin: var(--spacing-md) 0; color: var(--text-muted); font-size: 0.875rem">
          This will disconnect and remove the server configuration.
        </p>
        <div class="modal-actions">
          <button type="button" class="btn" onclick="hideConfirmDeleteModal()">Cancel</button>
          <button
            type="button"
            class="btn"
            style="background: var(--danger); color: white"
            onclick="confirmDeleteServer()"
          >
            Delete
          </button>
        </div>
      </div>
    </div>

    <script src="app.js"></script>
    <script src="workflow.js"></script>
    <script src="brain.js"></script>
  </body>
</html>
